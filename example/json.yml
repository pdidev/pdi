# SPDX-FileCopyrightText: 2023-2024 Commissariat a l'energie atomique et aux energies alternatives (CEA)
#
# SPDX-License-Identifier: BSD-3-Clause

# duration in seconds
duration: 0.75
# global [height, width] (excluding boundary conditions or ghosts)
datasize: [60, 12]
# degree of parallelism
parallelism: { height: 2, width: 2 }

# only the following config is passed to PDI
pdi:
  metadata: # type of small values for which PDI keeps a copy
    iter:   int                    # current iteration id
    dsize:  { size: 2, type: array, subtype: int } # local data size including ghosts/boundary
    psize:  { size: 2, type: array, subtype: int } # number of processes in each dimension
    pcoord: { size: 2, type: array, subtype: int } # coordinate of the process
    mpi_rank: int
    mpi_size: int
  data: # type of values for which PDI does not keep a copy
    main_field: { size: [ '$dsize[0]', '$dsize[1]' ], type: array, subtype: double }

#! [example_config_json_plugin]
  plugins:
    json:
    - pcoord: params_pcoord_proc_${mpi_rank}.json
    - file : params1.json
      write : [dsize, psize]
      when: ${mpi_rank}=0
    - file : params2.json
      when: ${mpi_rank}=0
      write : [mpi_rank, mpi_size, dsize, psize, pcoord]
    - file : main_field_proc_${mpi_rank}_iter_${iter}.json
      write : [main_field]
      when: $iter % 100 = 0
    
      
#! [example_config_json_plugin]
